<?php	function UpdateUserInfo()	{		// just make this variable a little more convenient to use		$sf =& $_REQUEST['sf'];		$sfv =& $GLOBALS['SCORE']['sc_REQUEST']; // validated form data				$element_array[] = 'email_messages';				// check for password change attempt		if( isset($sf['TEXT']['current_password']) && strlen($sf['TEXT']['current_password']) )		{			update_user_pass();		}				// update using element_array		$update = '';		foreach ($element_array as $el)		{			$update .= "$el='{$sfv->values['TEXT'][$el]}',";		}				// update database values		$update = substr($update,0,-1);		$sql = "UPDATE users SET $update WHERE id='{$_SESSION['score_user']->data['id']}'";				// update session values		if(dbsql ($sql))		  foreach ($element_array as $el)		    $_SESSION['score_user']->data[$el] = $sfv->values['TEXT'][$el];	}	function update_user_pass()	{		// just make this variable a little more convenient to use		$sf =& $_REQUEST['sf'];		$sfv =& $GLOBALS['SCORE']['sc_REQUEST']; // validated form data				// doesn't entered password match users real current password?		if ( $sf['TEXT']['current_password'] !== $_SESSION['score_user']->data['pass'] )		{			$GLOBALS['SCORE']['errors'][] = "Password you entered does not match your current password.";			return false;		}				// do both password1 and password2 match		if ( $sf['TEXT']['new_password1'] !== $sf['TEXT']['new_password2'] ) 		{			$GLOBALS['SCORE']['errors'][] = "Your new passwords didn't match";			return false;		}				// we can't have null passwords		if ( strlen($sf['TEXT']['new_password1']) < 3) 		{			$GLOBALS['SCORE']['errors'][] = "Your password is too short. It must be at least 3 characters.";			return false;		}						// ok, then we can update		dbq("UPDATE `users` SET pass='{$sfv->values['TEXT']['new_password1']}' WHERE id='{$_SESSION['score_user']->data['id']}' LIMIT 1");		$_SESSION['score_user']->data['pass'] = $sf['TEXT']['new_password1'];				$GLOBALS['SCORE']['errors'][] = "Your password has been updated.";		return true;	}?>